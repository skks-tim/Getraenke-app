<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intelligente Getr√§nkeabrechnung</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        @font-face {
            font-family: 'FirmaFont';
            src: url('Tipico_Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        body {
            font-family: 'FirmaFont', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: url('hintergrund.jpg') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: transparent;
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.5);
            border-bottom: 1px solid #ddd;
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: rgba(255, 255, 255, 0.5);
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .nav-tab.active {
            background: rgba(255, 255, 255, 0.5);
            border-bottom: 3px solid #2196F3;
            color: #2196F3;
        }
        
        .nav-tab:hover {
            background: #e0e0e0;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #2196F3;
        }
        
        .btn {
            background: #2196F3;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #4CAF50;
        }
        
        .btn-success:hover {
            background: #45a049;
        }
        
        .btn-danger {
            background: #f44336;
        }
        
        .btn-danger:hover {
            background: #da190b;
        }
        
        .btn-warning {
            background: #ff9800;
        }
        
        .btn-warning:hover {
            background: #e68900;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #333;
        }
        
        .table tr:hover {
            background: #f5f5f5;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.5);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 4px solid #2196F3;
        }
        
        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: rgba(255, 255, 255, 0.5);
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
        }
        
        .close {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }
        
        .close:hover {
            color: #000;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                flex-direction: column;
            }

            /* Tabellen auf kleinen Bildschirmen horizontal scrollen */
            .table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
        }

        /* Dark Mode */
        body.dark { background: #121212; }
        /* Zus√§tzliche Dark-Mode-Regeln f√ºr Input, Buttons, Tabellen, Texte */
        body.dark .form-group input,
        body.dark .form-group select {
            background-color: #333;
            color: #eee;
            border-color: #555;
        }
        body.dark .btn {
            background-color: #444;
            color: #eee;
        }
        body.dark .btn:hover {
            background-color: #666;
        }
        body.dark .table th {
            background-color: #222;
            color: #ddd;
        }
        body.dark .table td {
            color: #ccc;
        }
        body.dark .nav-tab:hover {
            background-color: rgba(255,255,255,0.2);
        }
        body.dark .header h1,
        body.dark .header p {
            color: #fff;
        }
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .login-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            max-width: 300px;
            width: 100%;
        }
        .login-box input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        body.dark .login-box { background: #333; color: #eee; }
        body.dark .login-box input { background: #555; color: #eee; border-color: #777; }
    </style>
</head>
<body>
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <h2 data-i18n="loginTitle">Anmeldung</h2>
            <form id="loginForm">
                <input type="text" id="loginUsername" placeholder="Benutzername" required>
                <input type="password" id="loginPassword" placeholder="Passwort" required>
                <button type="submit" class="btn" data-i18n="loginButton">Login</button>
            </form>
            <button id="registerBtn" class="btn" data-i18n="register">Registrieren</button>
        </div>
    </div>
    <div id="app" style="display:none;">
    <div class="header">
        <h1 data-i18n="title">ü•§ Intelligente Getr√§nkeabrechnung</h1>
        <p data-i18n="subtitle">Zentrale Eingabemaske mit automatischer Berechnung</p>
        <button id="darkModeToggle" class="btn" data-i18n="darkMode">üåô Dark Mode</button>
        <select id="languageSelect" class="btn">
            <option value="de">DE</option>
            <option value="en">EN</option>
        </select>
        <button id="backupBtn" class="btn" data-i18n="backup">üíæ Backup</button>
        <button id="csvExportBtn" class="btn" data-i18n="csvExport">üìÑ CSV Export</button>
        <button id="importBtn" class="btn" data-i18n="import">üìÇ Import</button>
        <input type="file" id="importFile" accept=".json" style="display:none">
        <button id="resetBtn" class="btn btn-danger" data-i18n="reset">‚Üª Reset</button>
        <span id="currentUserDisplay" style="margin-left:10px"></span>
        <button id="logoutBtn" class="btn" data-i18n="logout">üö™ Logout</button>
    </div>
    <div class="container">
        
        <div class="nav-tabs">
            <button class="nav-tab active" data-i18n="tabEingaben" onclick="showTab('eingaben')">üìã Eingaben</button>
            <button class="nav-tab" data-i18n="tabProdukte" onclick="showTab('produkte')">ü•§ Produkte</button>
            <button class="nav-tab" data-i18n="tabAuswertung" onclick="showTab('auswertung')">üìä Auswertung</button>
            <button class="nav-tab" data-i18n="tabTodos" onclick="showTab('todos')">üìù ToDos</button>
            <button class="nav-tab" data-i18n="tabInventar" onclick="showTab('inventar')">üì¶ Inventar</button>
            <button class="nav-tab" data-i18n="tabAnleitung" onclick="showTab('anleitung')">üìñ Anleitung</button>
        </div>
        
        <!-- Eingaben Tab -->
        <div id="eingaben" class="tab-content active">
            <h2>Zentrale Eingabemaske</h2>
            <form id="eingabeForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="datum">Datum:</label>
                        <input type="date" id="datum" required>
                    </div>
                    <div class="form-group">
                        <label for="typ">Typ:</label>
                        <select id="typ" onchange="toggleFields()" required>
                            <option value="" class="select-placeholder" data-i18n="selectPlaceholder">Bitte w√§hlen...</option>
                            <option value="Kaltgetr√§nk">Kaltgetr√§nk</option>
                            <option value="Hei√ügetr√§nk">Hei√ügetr√§nk</option>
                            <option value="GWS Eingang">GWS Eingang</option>
                        </select>
                    </div>
                </div>
                
                <div id="produktFields" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="produkt">Produkt:</label>
                            <select id="produkt" onchange="updatePreise()">
                                <option value="" class="select-placeholder" data-i18n="selectPlaceholder">Bitte w√§hlen...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="menge">Menge:</label>
                            <input type="number" id="menge" min="1" step="1">
                        </div>
                    </div>
                </div>
                
                <div id="heissFields" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="zaehlerAlt">Z√§hler alt:</label>
                            <input type="number" id="zaehlerAlt" min="0" step="1">
                        </div>
                        <div class="form-group">
                            <label for="zaehlerNeu">Z√§hler neu:</label>
                            <input type="number" id="zaehlerNeu" min="0" step="1">
                        </div>
                    </div>
                </div>
                
                <div id="gwsFields" style="display: none;">
                    <div class="form-group">
                        <label for="betragGws">Betrag GWS (‚Ç¨):</label>
                        <input type="number" id="betragGws" min="0" step="0.01">
                    </div>
                </div>
                
                <button type="submit" class="btn btn-success">Eintrag hinzuf√ºgen</button>
            </form>
            
            <div id="eingabenTabelle">
                <h3>Alle Eingaben</h3>
                <table class="table" id="eingabenTable">
                    <thead>
                        <tr>
                            <th>Datum</th>
                            <th>Typ</th>
                            <th>Produkt</th>
                            <th>Menge</th>
                            <th>Einnahmen</th>
                            <th>Marge</th>
                            <th>Aktionen</th>
                        </tr>
                    </thead>
                    <tbody id="eingabenTableBody">
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Produkte Tab -->
        <div id="produkte" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Produktverwaltung</h2>
                <button class="btn btn-success" onclick="showProduktModal()">+ Neues Produkt</button>
            </div>
            
            <table class="table" id="produkteTable">
                <thead>
                    <tr>
                        <th>Produkt</th>
                        <th>Einkaufspreis (‚Ç¨)</th>
                        <th>Verkaufspreis (‚Ç¨)</th>
                        <th>Pfand (‚Ç¨)</th>
                        <th>Marge (‚Ç¨)</th>
                        <th>Aktionen</th>
                    </tr>
                </thead>
                <tbody id="produkteTableBody">
                </tbody>
            </table>
        </div>
        
        <!-- Auswertung Tab -->
        <div id="auswertung" class="tab-content">
            <h2>Auswertung & Kennzahlen</h2>
            
            <div class="stats-grid" id="statsGrid">
                <!-- Wird dynamisch gef√ºllt -->
            </div>
            
            <div id="statusMessage"></div>
        </div>

        <!-- ToDo Tab -->
        <div id="todos" class="tab-content">
            <h2 data-i18n="todoHeader">Aufgabenliste</h2>
            <div class="form-row">
                <input type="text" id="todoText" placeholder="Neue Aufgabe">
                <button class="btn" id="addTodoBtn" data-i18n="addTodo">Hinzuf√ºgen</button>
            </div>
            <ul id="todoList" style="margin-top:10px;"></ul>
        </div>

        <!-- Inventar Tab -->
        <div id="inventar" class="tab-content">
            <h2 data-i18n="inventoryHeader">Inventarliste</h2>
            <form id="inventarForm">
                <div class="form-row">
                    <input type="text" id="inventarName" placeholder="Artikel" required>
                    <input type="number" id="inventarMenge" placeholder="Menge" min="0" step="1" required>
                    <button type="submit" class="btn" data-i18n="addItem">Hinzuf√ºgen</button>
                </div>
            </form>
            <table class="table">
                <thead>
                    <tr>
                        <th data-i18n="item">Artikel</th>
                        <th data-i18n="quantity">Menge</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="inventarTableBody"></tbody>
            </table>
        </div>

        <!-- Anleitung Tab -->
        <div id="anleitung" class="tab-content">
            <h2>üìñ Bedienungsanleitung</h2>
            
            <div class="success">
                <h3>üöÄ Erste Schritte</h3>
                <ol>
                    <li><strong>Produkte verwalten:</strong> Gehen Sie zum Tab "Produkte" und f√ºgen Sie Ihre Getr√§nke mit Preisen hinzu.</li>
                    <li><strong>Transaktionen erfassen:</strong> Wechseln Sie zum Tab "Eingaben" und tragen Sie Ihre Verk√§ufe ein.</li>
                    <li><strong>Auswertung pr√ºfen:</strong> Im Tab "Auswertung" sehen Sie alle wichtigen Kennzahlen auf einen Blick.</li>
                </ol>
            </div>
            
            <h3>üìã Eingabetypen erkl√§rt</h3>
            <ul>
                <li><strong>Kaltgetr√§nk:</strong> F√ºr den Verkauf von Flaschen/Dosen. Ben√∂tigt: Produkt ausw√§hlen + Anzahl eingeben.</li>
                <li><strong>Hei√ügetr√§nk:</strong> F√ºr Kaffeemaschinen mit Z√§hler. Ben√∂tigt: Alter und neuer Z√§hlerstand.</li>
                <li><strong>GWS Eingang:</strong> F√ºr tats√§chliche Geldeinnahmen. Ben√∂tigt: Betrag in Euro.</li>
            </ul>
            
            <h3>üéØ Automatische Berechnungen</h3>
            <ul>
                <li>Preise werden automatisch aus der Produktdatenbank √ºbernommen</li>
                <li>Margen und Gesamteinnahmen werden automatisch berechnet</li>
                <li>Das System warnt bei Verlusten oder Fehlern</li>
            </ul>
            
            <div class="warning">
                <h3>‚ö†Ô∏è Warnsystem</h3>
                <ul>
                    <li><strong>Marge &lt; 0:</strong> Verlustgesch√§ft</li>
                    <li><strong>Fehlende Preise:</strong> √úberpr√ºfung erforderlich</li>
                    <li><strong>Z√§hler neu &lt; alt:</strong> Eingabefehler</li>
                    <li><strong>Soll/Ist Abweichung &gt; ¬±10‚Ç¨:</strong> Kontrolle n√∂tig</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Produkt Modal -->
    <div id="produktModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProduktModal()">&times;</span>
            <h2 id="modalTitle">Neues Produkt hinzuf√ºgen</h2>
            <form id="produktForm">
                <input type="hidden" id="editIndex" value="-1">
                <div class="form-group">
                    <label for="produktName">Produktname:</label>
                    <input type="text" id="produktName" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="einkaufspreis">Einkaufspreis (‚Ç¨):</label>
                        <input type="number" id="einkaufspreis" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="verkaufspreis">Verkaufspreis (‚Ç¨):</label>
                        <input type="number" id="verkaufspreis" min="0" step="0.01" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="pfand">Pfand (‚Ç¨):</label>
                    <input type="number" id="pfand" min="0" step="0.01" value="0">
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn" onclick="closeProduktModal()">Abbrechen</button>
                    <button type="submit" class="btn btn-success">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    </div>
    <script>
        // Globale Variablen
        let produkte = [];
        let eingaben = [];
        let todos = [];
        let inventar = [];
        let users = [];
        let currentUser = null;
        let currentLang = 'de';

        const translations = {
            de: {
                title: 'ü•§ Intelligente Getr√§nkeabrechnung',
                subtitle: 'Zentrale Eingabemaske mit automatischer Berechnung',
                loginTitle: 'Anmeldung',
                loginButton: 'Login',
                register: 'Registrieren',
                logout: 'üö™ Logout',
                darkMode: 'üåô Dark Mode',
                backup: 'üíæ Backup',
                csvExport: 'üìÑ CSV Export',
                import: 'üìÇ Import',
                reset: '‚Üª Reset',
                tabEingaben: 'üìã Eingaben',
                tabProdukte: 'ü•§ Produkte',
                tabAuswertung: 'üìä Auswertung',
                tabTodos: 'üìù Aufgaben',
                tabInventar: 'üì¶ Inventar',
                tabAnleitung: 'üìñ Anleitung',
                todoHeader: 'Aufgabenliste',
                addTodo: 'Hinzuf√ºgen',
                inventoryHeader: 'Inventarliste',
                addItem: 'Hinzuf√ºgen',
                item: 'Artikel',
                quantity: 'Menge',
                selectPlaceholder: 'Bitte w√§hlen...'
            },
            en: {
                title: 'ü•§ Beverage Accounting',
                subtitle: 'Central input with automatic calculation',
                loginTitle: 'Login',
                loginButton: 'Login',
                register: 'Register',
                logout: 'üö™ Logout',
                darkMode: 'üåô Dark Mode',
                backup: 'üíæ Backup',
                csvExport: 'üìÑ CSV Export',
                import: 'üìÇ Import',
                reset: '‚Üª Reset',
                tabEingaben: 'üìã Entries',
                tabProdukte: 'ü•§ Products',
                tabAuswertung: 'üìä Statistics',
                tabTodos: 'üìù Tasks',
                tabInventar: 'üì¶ Inventory',
                tabAnleitung: 'üìñ Guide',
                todoHeader: 'Task List',
                addTodo: 'Add',
                inventoryHeader: 'Inventory',
                addItem: 'Add',
                item: 'Item',
                quantity: 'Qty',
                selectPlaceholder: 'Please choose...'
            }
        };

        function applyLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('getraenke-lang', lang);
            const t = translations[lang] || translations['de'];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.textContent = t[key];
            });
            document.getElementById('loginUsername').placeholder = lang === 'en' ? 'Username' : 'Benutzername';
            document.getElementById('loginPassword').placeholder = lang === 'en' ? 'Password' : 'Passwort';
            document.getElementById('todoText').placeholder = lang === 'en' ? 'New task' : 'Neue Aufgabe';
            document.getElementById('inventarName').placeholder = lang === 'en' ? 'Item' : 'Artikel';
            document.getElementById('inventarMenge').placeholder = lang === 'en' ? 'Qty' : 'Menge';
            document.querySelectorAll('.select-placeholder').forEach(el => {
                el.textContent = t.selectPlaceholder;
            });
            updateProduktDropdown();
        }
        
        // Initialisierung
        document.addEventListener('DOMContentLoaded', function() {
            loadUsers();
            const savedLang = localStorage.getItem('getraenke-lang') || 'de';
            document.getElementById('languageSelect').value = savedLang;
            applyLanguage(savedLang);
            const savedUser = localStorage.getItem("getraenke-currentUser");
            if (savedUser) currentUser = JSON.parse(savedUser);
            if (!currentUser) {
                document.getElementById("app").style.display = "none";
                document.getElementById("loginOverlay").style.display = "flex";
                return;
            } else {
                document.getElementById("app").style.display = "block";
                document.getElementById("currentUserDisplay").textContent = "üë§ " + currentUser.username;
            }
            loadData();
            // Heutiges Datum setzen
            document.getElementById('datum').valueAsDate = new Date();
            
            
            // Standard-Produkte hinzuf√ºgen falls keine vorhanden
            if (produkte.length === 0) {
                addDefaultProducts();
            }
            
            updateProduktDropdown();
            updateTables();
            updateStats();
    // Dark Mode Toggle
    document.getElementById('darkModeToggle').addEventListener('click', function() {
        document.body.classList.toggle('dark');
        if (document.body.classList.contains('dark')) {
            this.textContent = '‚òÄÔ∏è Light Mode';
        } else {
            this.textContent = 'üåô Dark Mode';
        }
    });

    document.getElementById('languageSelect').addEventListener('change', function() {
        applyLanguage(this.value);
    });

    // Hamburger Menu Toggle (nur wenn Element existiert)
    const menuToggle = document.getElementById('menuToggle');
    if (menuToggle) {
        menuToggle.addEventListener('click', function() {
            document.querySelector('.nav-tabs').classList.toggle('open');
        });
    }
        });
        
        // Standard-Produkte hinzuf√ºgen
        function addDefaultProducts() {
            const defaultProducts = [
                { name: 'Cola', einkauf: 0.47, verkauf: 2.00, pfand: 0.25 },
                { name: 'Cola Zero', einkauf: 0.47, verkauf: 2.00, pfand: 0.25 },
                { name: 'Fanta', einkauf: 0.47, verkauf: 2.00, pfand: 0.25 },
                { name: 'Mezzo Mix', einkauf: 0.47, verkauf: 2.00, pfand: 0.25 },
                { name: 'Wasser', einkauf: 0.47, verkauf: 2.00, pfand: 0.25 },
                { name: 'Red Bull', einkauf: 0.88, verkauf: 2.50, pfand: 0 },
                { name: 'Kaffee', einkauf: 0.00, verkauf: 1.00, pfand: 0 }
            ];
            defaultProducts.forEach(product => {
                produkte.push(product);
            });
            saveData();
        }
        
        // Tab-Funktionalit√§t
        function showTab(tabName) {
            // Alle Tabs verstecken
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Alle Tab-Buttons deaktivieren
            const buttons = document.querySelectorAll('.nav-tab');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Gew√§hlten Tab anzeigen
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Daten aktualisieren
            if (tabName === 'auswertung') {
                updateStats();
            }
        }
        
        // Felder je nach Typ ein-/ausblenden
        function toggleFields() {
            const typ = document.getElementById('typ').value;
            const produktFields = document.getElementById('produktFields');
            const heissFields = document.getElementById('heissFields');
            const gwsFields = document.getElementById('gwsFields');
            
            // Alle Felder verstecken
            produktFields.style.display = 'none';
            heissFields.style.display = 'none';
            gwsFields.style.display = 'none';
            
            // Relevante Felder anzeigen
            if (typ === 'Kaltgetr√§nk') {
                produktFields.style.display = 'block';
            } else if (typ === 'Hei√ügetr√§nk') {
                produktFields.style.display = 'block';
                heissFields.style.display = 'block';
            } else if (typ === 'GWS Eingang') {
                gwsFields.style.display = 'block';
            }
        }
        
        // Produkt-Dropdown aktualisieren
        function updateProduktDropdown() {
            const select = document.getElementById('produkt');
            select.innerHTML = `<option value="" class="select-placeholder">${translations[currentLang].selectPlaceholder}</option>`;
            
            produkte.forEach((produkt, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = produkt.name;
                select.appendChild(option);
            });
        }
        
        // Preise aktualisieren bei Produktauswahl
        function updatePreise() {
            const produktIndex = document.getElementById('produkt').value;
            if (produktIndex !== '') {
                const produkt = produkte[produktIndex];
                // Hier k√∂nnten Preise angezeigt werden
            }
        }
        
        // Eingabe-Formular verarbeiten
        document.getElementById('eingabeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const datum = document.getElementById('datum').value;
            const typ = document.getElementById('typ').value;
            
            let eintrag = {
                datum: datum,
                typ: typ,
                timestamp: new Date().getTime()
            };
            
            if (typ === 'Kaltgetr√§nk') {
                const produktIndex = document.getElementById('produkt').value;
                const menge = parseInt(document.getElementById('menge').value);
                
                if (produktIndex === '' || !menge) {
                    alert('Bitte Produkt und Menge eingeben!');
                    return;
                }
                
                const produkt = produkte[produktIndex];
                eintrag.produkt = produkt.name;
                eintrag.menge = menge;
                eintrag.einkaufspreis = produkt.einkauf;
                eintrag.verkaufspreis = produkt.verkauf;
                eintrag.pfand = produkt.pfand;
                eintrag.kosten = produkt.einkauf * menge;
                eintrag.einnahmen = produkt.verkauf * menge;
                eintrag.pfandEinnahmen = produkt.pfand * menge;
                eintrag.marge = (produkt.verkauf - produkt.einkauf) * menge;
                
            } else if (typ === 'Hei√ügetr√§nk') {
                const produktIndex = document.getElementById('produkt').value;
                const zaehlerAlt = parseInt(document.getElementById('zaehlerAlt').value);
                const zaehlerNeu = parseInt(document.getElementById('zaehlerNeu').value);
                
                if (produktIndex === '' || zaehlerAlt === undefined || zaehlerNeu === undefined) {
                    alert('Bitte alle Felder ausf√ºllen!');
                    return;
                }
                
                if (zaehlerNeu < zaehlerAlt) {
                    alert('Neuer Z√§hlerstand kann nicht kleiner als alter Z√§hlerstand sein!');
                    return;
                }
                
                const produkt = produkte[produktIndex];
                const differenz = zaehlerNeu - zaehlerAlt;
                
                eintrag.produkt = produkt.name;
                eintrag.menge = differenz;
                eintrag.zaehlerAlt = zaehlerAlt;
                eintrag.zaehlerNeu = zaehlerNeu;
                eintrag.einkaufspreis = produkt.einkauf;
                eintrag.verkaufspreis = produkt.verkauf;
                eintrag.kosten = produkt.einkauf * differenz;
                eintrag.einnahmen = produkt.verkauf * differenz;
                eintrag.marge = (produkt.verkauf - produkt.einkauf) * differenz;
                
            } else if (typ === 'GWS Eingang') {
                const betrag = parseFloat(document.getElementById('betragGws').value);
                
                if (!betrag) {
                    alert('Bitte Betrag eingeben!');
                    return;
                }
                
                eintrag.betragGws = betrag;
            }
            
            eingaben.push(eintrag);
            saveData();
            updateTables();
            updateStats();
            
            // Formular zur√ºcksetzen
            this.reset();
            document.getElementById('datum').valueAsDate = new Date();
            toggleFields();
            
            alert('Eintrag erfolgreich hinzugef√ºgt!');
        });
        
        // Produkt-Modal anzeigen
        function showProduktModal(index = -1) {
            const modal = document.getElementById('produktModal');
            const title = document.getElementById('modalTitle');
            const form = document.getElementById('produktForm');
            
            if (index >= 0) {
                // Bearbeiten
                title.textContent = 'Produkt bearbeiten';
                const produkt = produkte[index];
                document.getElementById('editIndex').value = index;
                document.getElementById('produktName').value = produkt.name;
                document.getElementById('einkaufspreis').value = produkt.einkauf;
                document.getElementById('verkaufspreis').value = produkt.verkauf;
                document.getElementById('pfand').value = produkt.pfand;
            } else {
                // Neu hinzuf√ºgen
                title.textContent = 'Neues Produkt hinzuf√ºgen';
                form.reset();
                document.getElementById('editIndex').value = -1;
                document.getElementById('pfand').value = 0;
            }
            
            modal.style.display = 'block';
        }
        
        // Produkt-Modal schlie√üen
        function closeProduktModal() {
            document.getElementById('produktModal').style.display = 'none';
        }
        
        // Produkt-Formular verarbeiten
        document.getElementById('produktForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const editIndex = parseInt(document.getElementById('editIndex').value);
            const name = document.getElementById('produktName').value;
            const einkauf = parseFloat(document.getElementById('einkaufspreis').value);
            const verkauf = parseFloat(document.getElementById('verkaufspreis').value);
            const pfand = parseFloat(document.getElementById('pfand').value);
            
            if (verkauf <= einkauf) {
                alert('Verkaufspreis muss h√∂her als Einkaufspreis sein!');
                return;
            }
            
            const produkt = { name, einkauf, verkauf, pfand };
            
            if (editIndex >= 0) {
                // Bearbeiten
                produkte[editIndex] = produkt;
            } else {
                // Neu hinzuf√ºgen
                produkte.push(produkt);
            }
            
            saveData();
            updateProduktDropdown();
            updateTables();
            closeProduktModal();
            
            alert('Produkt erfolgreich gespeichert!');
        });
        
        // Produkt l√∂schen
        function deleteProdukt(index) {
            if (confirm('Produkt wirklich l√∂schen?')) {
                produkte.splice(index, 1);
                saveData();
                updateProduktDropdown();
                updateTables();
            }
        }
        
        // Eintrag l√∂schen
        function deleteEintrag(index) {
            if (confirm('Eintrag wirklich l√∂schen?')) {
                eingaben.splice(index, 1);
                saveData();
                updateTables();
                updateStats();
            }
        }

        // Todo l√∂schen
        function deleteTodo(index) {
            todos.splice(index, 1);
            saveData();
            updateTodoList();
        }

        function toggleTodo(index) {
            todos[index].done = !todos[index].done;
            saveData();
            updateTodoList();
        }

        // Inventar l√∂schen
        function deleteInventar(index) {
            inventar.splice(index, 1);
            saveData();
            updateInventarTable();
        }
        
        // Tabellen aktualisieren
        function updateTables() {
            updateProdukteTable();
            updateEingabenTable();
            updateTodoList();
            updateInventarTable();
        }
        
        // Produkte-Tabelle aktualisieren
        function updateProdukteTable() {
            const tbody = document.getElementById('produkteTableBody');
            tbody.innerHTML = '';
            
            produkte.forEach((produkt, index) => {
                const row = tbody.insertRow();
                const marge = produkt.verkauf - produkt.einkauf;
                
                row.innerHTML = `
                    <td>${produkt.name}</td>
                    <td>${produkt.einkauf.toFixed(2)} ‚Ç¨</td>
                    <td>${produkt.verkauf.toFixed(2)} ‚Ç¨</td>
                    <td>${produkt.pfand.toFixed(2)} ‚Ç¨</td>
                    <td style="color: ${marge > 0 ? 'green' : 'red'}">${marge.toFixed(2)} ‚Ç¨</td>
                    <td>
                        <button class="btn btn-warning" onclick="showProduktModal(${index})">‚úèÔ∏è Bearbeiten</button>
                        <button class="btn btn-danger" onclick="deleteProdukt(${index})">üóëÔ∏è L√∂schen</button>
                    </td>
                `;
            });
        }
        
        // Eingaben-Tabelle aktualisieren
        function updateEingabenTable() {
            const tbody = document.getElementById('eingabenTableBody');
            tbody.innerHTML = '';
            
            eingaben.forEach((eintrag, index) => {
                const row = tbody.insertRow();
                
                let produktText = eintrag.produkt || '-';
                let mengeText = eintrag.menge || '-';
                let einnahmenText = '-';
                let margeText = '-';
                
                if (eintrag.typ === 'Kaltgetr√§nk' || eintrag.typ === 'Hei√ügetr√§nk') {
                    einnahmenText = `${eintrag.einnahmen.toFixed(2)} ‚Ç¨`;
                    margeText = `${eintrag.marge.toFixed(2)} ‚Ç¨`;
                } else if (eintrag.typ === 'GWS Eingang') {
                    einnahmenText = `${eintrag.betragGws.toFixed(2)} ‚Ç¨`;
                    produktText = 'GWS Eingang';
                    mengeText = '-';
                }
                
                row.innerHTML = `
                    <td>${eintrag.datum}</td>
                    <td>${eintrag.typ}</td>
                    <td>${produktText}</td>
                    <td>${mengeText}</td>
                    <td>${einnahmenText}</td>
                    <td style="color: ${eintrag.marge > 0 ? 'green' : (eintrag.marge < 0 ? 'red' : 'black')}">${margeText}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteEintrag(${index})">üóëÔ∏è L√∂schen</button>
                    </td>
                `;
            });
        }

        // ToDo-Liste aktualisieren
        function updateTodoList() {
            const list = document.getElementById('todoList');
            list.innerHTML = '';
            todos.forEach((todo, index) => {
                const li = document.createElement('li');
                li.style.textDecoration = todo.done ? 'line-through' : 'none';
                li.innerHTML = `<input type="checkbox" onclick="toggleTodo(${index})" ${todo.done ? 'checked' : ''}> ${todo.text} <button class="btn btn-danger" onclick="deleteTodo(${index})">üóëÔ∏è</button>`;
                list.appendChild(li);
            });
        }

        // Inventartabelle aktualisieren
        function updateInventarTable() {
            const tbody = document.getElementById('inventarTableBody');
            tbody.innerHTML = '';
            inventar.forEach((item, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.menge}</td>
                    <td><button class="btn btn-danger" onclick="deleteInventar(${index})">üóëÔ∏è</button></td>
                `;
            });
        }
        
        // Statistiken aktualisieren
        function updateStats() {
            const stats = calculateStats();
            const statsGrid = document.getElementById('statsGrid');
            const statusMessage = document.getElementById('statusMessage');
            
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <h3>Einnahmen Kaltgetr√§nke</h3>
                    <div class="value">${stats.einnahmenKalt.toFixed(2)} ‚Ç¨</div>
                </div>
                <div class="stat-card">
                    <h3>Einnahmen Hei√ügetr√§nke</h3>
                    <div class="value">${stats.einnahmenHeiss.toFixed(2)} ‚Ç¨</div>
                </div>
                <div class="stat-card">
                    <h3>Pfand Einnahmen</h3>
                    <div class="value">${stats.pfandEinnahmen.toFixed(2)} ‚Ç¨</div>
                </div>
                <div class="stat-card">
                    <h3>Einkaufskosten</h3>
                    <div class="value">${stats.einkaufskosten.toFixed(2)} ‚Ç¨</div>
                </div>
                <div class="stat-card">
                    <h3>GWS Eingang (Ist)</h3>
                    <div class="value">${stats.gwsEingang.toFixed(2)} ‚Ç¨</div>
                </div>
                <div class="stat-card">
                    <h3>Gesamtmarge</h3>
                    <div class="value" style="color: ${stats.gesamtmarge >= 0 ? 'green' : 'red'}">${stats.gesamtmarge.toFixed(2)} ‚Ç¨</div>
                </div>
                <div class="stat-card">
                    <h3>Soll-Einnahmen (ohne Pfand)</h3>
                    <div class="value">${stats.sollEinnahmen.toFixed(2)} ‚Ç¨</div>
                </div>
                <div class="stat-card">
                    <h3>Differenz Soll-Ist</h3>
                    <div class="value" style="color: ${Math.abs(stats.differenz) > 10 ? 'red' : 'green'}">${stats.differenz.toFixed(2)} ‚Ç¨</div>
                </div>
            `;
            
            // Status-Nachricht
            let statusClass = 'success';
            let statusText = '‚úÖ Alles in Ordnung';
            
            if (Math.abs(stats.differenz) > 10) {
                statusClass = 'error';
                statusText = '‚ö†Ô∏è ABWEICHUNG PR√úFEN! Differenz zwischen Soll- und Ist-Einnahmen ist zu gro√ü.';
            } else if (stats.differenz < 0) {
                statusClass = 'warning';
                statusText = 'üí∞ MEHR GELD ALS ERWARTET - Bitte kontrollieren!';
            }
            
            statusMessage.innerHTML = `<div class="${statusClass}">${statusText}</div>`;
        }
        
        // Statistiken berechnen
        function calculateStats() {
            let einnahmenKalt = 0;
            let einnahmenHeiss = 0;
            let pfandEinnahmen = 0;
            let einkaufskosten = 0;
            let gwsEingang = 0;
            let gesamtmarge = 0;
            
            eingaben.forEach(eintrag => {
                if (eintrag.typ === 'Kaltgetr√§nk') {
                    einnahmenKalt += eintrag.einnahmen || 0;
                    pfandEinnahmen += eintrag.pfandEinnahmen || 0;
                    einkaufskosten += eintrag.kosten || 0;
                    gesamtmarge += eintrag.marge || 0;
                } else if (eintrag.typ === 'Hei√ügetr√§nk') {
                    einnahmenHeiss += eintrag.einnahmen || 0;
                    einkaufskosten += eintrag.kosten || 0;
                    gesamtmarge += eintrag.marge || 0;
                } else if (eintrag.typ === 'GWS Eingang') {
                    gwsEingang += eintrag.betragGws || 0;
                }
            });
            
            const sollEinnahmen = einnahmenKalt + einnahmenHeiss;
            const differenz = sollEinnahmen - gwsEingang;
            
            return {
                einnahmenKalt,
                einnahmenHeiss,
                pfandEinnahmen,
                einkaufskosten,
                gwsEingang,
                gesamtmarge,
                sollEinnahmen,
                differenz
            };
        }
        
        // Daten speichern
        function loadUsers() {
            const data = localStorage.getItem("getraenke-users");
            users = data ? JSON.parse(data) : [];
            if (!users.find(u => u.username === "admin")) {
                users.push({username: "admin", password: "admin", role: "admin"});
                saveUsers();
            }
        }

        function saveUsers() {
            localStorage.setItem("getraenke-users", JSON.stringify(users));
        }

        function saveData() {
            if (currentUser) {
                localStorage.setItem('getraenke-produkte-' + currentUser.username, JSON.stringify(produkte));
                localStorage.setItem('getraenke-eingaben-' + currentUser.username, JSON.stringify(eingaben));
                localStorage.setItem('getraenke-todos-' + currentUser.username, JSON.stringify(todos));
                localStorage.setItem('getraenke-inventar-' + currentUser.username, JSON.stringify(inventar));
            }
        }
        // Daten laden
        function loadData() {
            if (!currentUser) return;
            const savedProdukte = localStorage.getItem('getraenke-produkte-' + currentUser.username);
            const savedEingaben = localStorage.getItem('getraenke-eingaben-' + currentUser.username);
            const savedTodos = localStorage.getItem('getraenke-todos-' + currentUser.username);
            const savedInventar = localStorage.getItem('getraenke-inventar-' + currentUser.username);

            if (savedProdukte) {
                produkte = JSON.parse(savedProdukte);
            }

            if (savedEingaben) {
                eingaben = JSON.parse(savedEingaben);
            }
            if (savedTodos) {
                todos = JSON.parse(savedTodos);
            }
            if (savedInventar) {
                inventar = JSON.parse(savedInventar);
            }
        }
        
        // Modal schlie√üen bei Klick au√üerhalb
        window.onclick = function(event) {
            const modal = document.getElementById('produktModal');
            if (event.target === modal) {
                closeProduktModal();
            }
        }
        // Backup-Funktion: Produkte und Eingaben als JSON-Datei herunterladen
        document.getElementById('backupBtn').addEventListener('click', function() {
            const data = {
                produkte: produkte,
                eingaben: eingaben,
                todos: todos,
                inventar: inventar
            };
            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'getraenke_backup.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // CSV-Export der Eingaben
        document.getElementById('csvExportBtn').addEventListener('click', function() {
            if (eingaben.length === 0) {
                alert('Keine Eingaben zum Exportieren!');
                return;
            }

            // Spalten ermitteln
            const headers = [];
            eingaben.forEach(e => {
                Object.keys(e).forEach(k => {
                    if (!headers.includes(k)) headers.push(k);
                });
            });

            const rows = eingaben.map(e => headers.map(h => e[h] !== undefined ? e[h] : '').join(';'));
            const csvStr = [headers.join(';'), ...rows].join('\n');

            const blob = new Blob([csvStr], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'eingaben.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Import-Funktion: JSON-Datei einlesen und localStorage √ºberschreiben
        document.getElementById('importBtn').addEventListener('click', function() {
            document.getElementById('importFile').click();
        });
        document.getElementById('importFile').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (imported.produkte && imported.eingaben) {
                        localStorage.setItem('getraenke-produkte-' + currentUser.username, JSON.stringify(imported.produkte));
                        localStorage.setItem('getraenke-eingaben-' + currentUser.username, JSON.stringify(imported.eingaben));
                        localStorage.setItem('getraenke-todos-' + currentUser.username, JSON.stringify(imported.todos || []));
                        localStorage.setItem('getraenke-inventar-' + currentUser.username, JSON.stringify(imported.inventar || []));
                        alert('Import erfolgreich! Seite wird neu geladen.');
                        location.reload();
                    } else {
                        alert('Ung√ºltiges Backup-Format');
                    }
                } catch (err) {
                    alert('Fehler beim Einlesen der Datei');
                }
            };
            reader.readAsText(file);
        });

        // Todos hinzuf√ºgen
        document.getElementById('addTodoBtn').addEventListener('click', function() {
            const text = document.getElementById('todoText').value.trim();
            if (!text) return;
            todos.push({text: text, done: false});
            document.getElementById('todoText').value = '';
            saveData();
            updateTodoList();
        });

        document.getElementById('inventarForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('inventarName').value.trim();
            const menge = parseInt(document.getElementById('inventarMenge').value, 10) || 0;
            if (!name) return;
            inventar.push({name: name, menge: menge});
            this.reset();
            saveData();
            updateInventarTable();
        });

        // Reset-Funktion: localStorage leeren und Seite neu laden
        document.getElementById('resetBtn').addEventListener('click', function() {
            if (confirm('Wirklich alle Daten l√∂schen und zur√ºcksetzen?')) {
                localStorage.removeItem('getraenke-produkte-' + currentUser.username);
                localStorage.removeItem('getraenke-eingaben-' + currentUser.username);
                localStorage.removeItem('getraenke-todos-' + currentUser.username);
                localStorage.removeItem('getraenke-inventar-' + currentUser.username);
                location.reload();
            }
        });
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const u = document.getElementById('loginUsername').value.trim();
            const p = document.getElementById('loginPassword').value;
            const user = users.find(uobj => uobj.username === u && uobj.password === p);
            if (user) {
                currentUser = user;
                localStorage.setItem('getraenke-currentUser', JSON.stringify(user));
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                document.getElementById('currentUserDisplay').textContent = 'üë§ ' + currentUser.username;
                loadData();
                updateProduktDropdown();
                updateTables();
                updateStats();
            } else {
                alert('Login fehlgeschlagen');
            }
        });

        document.getElementById('registerBtn').addEventListener('click', function() {
            const uname = prompt('Benutzername:');
            if (!uname) return;
            if (users.find(u => u.username === uname)) { alert('Benutzer existiert'); return; }
            const pw = prompt('Passwort:') || '';
            const user = {username: uname, password: pw, role: 'standard'};
            users.push(user);
            saveUsers();
            alert('Benutzer angelegt');
        });

        document.getElementById('logoutBtn').addEventListener('click', function() {
            localStorage.removeItem('getraenke-currentUser');
            currentUser = null;
            location.reload();
        });
    </script>
</body>
</html>
